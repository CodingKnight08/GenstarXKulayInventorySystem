@page "/sales/view/{id:int}"
@using GenstarXKulayInventorySystem.Client.Pages.Sales.SaleItems
@using static GenstarXKulayInventorySystem.Shared.Helpers.BillingHelper
@using static GenstarXKulayInventorySystem.Shared.Helpers.ProductsEnumHelpers
@using static GenstarXKulayInventorySystem.Shared.Helpers.OrdersHelper
@using static GenstarXKulayInventorySystem.Shared.Helpers.UtilitiesHelper
<MudMainContent Class="w-auto h-100 d-flex flex-column gap-3">
    <MudCard Elevation="0" Class="w-100 d-flex px-4">
        <MudBreadcrumbs Items="_items"/>
        <MudText Typo="Typo.h4" Align="Align.Center"> Sales Information </MudText>
    </MudCard>
    @if (!IsEdit)
    {
        <MudCard Elevation="0" Class="w-100 d-flex flex-row justify-content-end gap-3">
            <MudIconButton Icon="@Icons.Material.Filled.Edit" Size="Size.Small" Color="Color.Success" OnClick="UpdateSale" Disabled="!IsSameDate"/>
        <MudIconButton Icon="@Icons.Material.Filled.Delete" Size="Size.Small" Color="Color.Error" Class="me-3" OnClick="DeleteSale" />
    </MudCard>
    
    <MudCard Elevation="0" Class="w-auto p-4">
        <MudGrid Spacing="6">
            
                <MudItem xl="4">
                    <MudTextField Placeholder="Enter Client Name" Label="Client Name" @bind-Value="Sales.NameOfClient" ReadOnly=true />
                </MudItem>
                <MudItem xl="2">
                    <MudSelect T="PaymentMethod?" @bind-Value="Sales.PaymentType" Label="Payment Method" Placeholder="Select PaymentMethod" ReadOnly=true>
                        @foreach (var method in Enum.GetValues(typeof(PaymentMethod)).Cast<PaymentMethod>())
                        {
                            <MudSelectItem T="PaymentMethod?" Value="@method">
                                @method.ToString()
                            </MudSelectItem>
                        }
                        <MudSelectItem T="PaymentMethod?" Value="null">N/A</MudSelectItem>
                    </MudSelect>
                </MudItem>
                <MudItem xl="2">
                    <MudSelect T="PurchaseRecieptOption?" @bind-Value="Sales.SalesOption" Label="Receipt Type" ReadOnly=true>


                        @foreach (var option in Enum.GetValues(typeof(PurchaseRecieptOption)).Cast<PurchaseRecieptOption>())
                        {
                            <MudSelectItem T="PurchaseRecieptOption?" Value="@option">
                                @(option == PurchaseRecieptOption.BIR ? "Invoice" : "Non-Voice")
                            </MudSelectItem>
                        }
                    </MudSelect>
                </MudItem>


                <MudItem xl="2">
                    <MudTextField T="string" Placeholder="Auto Generated" Label="Sale Number" @bind-Value="Sales.SalesNumber" ReadOnly=true/>
                </MudItem>
                <MudItem xl="2">
                    <MudSelect T="BranchOption"
                               @bind-Value="Sales.Branch"
                               ReadOnly=true
                               Label="Branch">
                        @foreach (var branch in Enum.GetValues(typeof(BranchOption)).Cast<BranchOption>())
                        {
                            <MudSelectItem T="BranchOption" Value="@branch">
                                @branch.ToString()
                            </MudSelectItem>
                        }

                    </MudSelect>
                </MudItem>
                <MudItem xl="3">
                    <MudTextField @bind-Value="Sales.RecieptReference"
                                  T="string"
                                  Placeholder="Enter Receipt No."
                                  Label="Reciept No."
                                  ReadOnly=true
                                  />
                </MudItem>
                @if (Sales.PaymentType == null)
                {


                    <MudItem xl="3">
                        <MudSelect T="PaymentTermsOption?" @bind-Value="Sales.PaymentTermsOption" Label="Payment Term Option" Placeholder="--Select Term Option--">
                            @foreach (var option in Enum.GetValues(typeof(PaymentTermsOption)).Cast<PaymentTermsOption>())
                            {
                                <MudSelectItem T="PaymentTermsOption?" Value="@option">
                                    @option.ToString()
                                </MudSelectItem>
                            }
                        </MudSelect>
                    </MudItem>
                }
                @if (Sales.PaymentTermsOption == PaymentTermsOption.Custom)
                {
                    <MudItem xl="2">
                        <MudNumericField T="int?" @bind-Value="Sales.CustomPaymentTermsOption" HideSpinButtons=true Placeholder="Number of days to be paid" Label="Custom Payment Term" Adornment="Adornment.End" AdornmentText="day's"/>
                    </MudItem>
                }
                <MudItem xl="12">
                @if (!IsLoading)
                {
                    <GetAllSaleItems DailySaleId="@Sales.Id"  />
                }
               
                </MudItem>
               
        </MudGrid>
        <MudCard Elevation="0" Class="d-flex flex-row justify-content-end mt-3 bg-transparent">
            <MudItem xl="3">
                <MudText Typo="Typo.subtitle2">
                    Total: ₱@(Sales.TotalAmount?.ToString("N2") ?? "0.00")
                </MudText>
            </MudItem>

        </MudCard>
    </MudCard>
    }
    else
    {
        <MudCard Elevation="0" Class="w-100">
            <EditDailySale Sale="EditableSale" OnCancel="CancelEdit" OnSave="SaveEdit"/>
        </MudCard>
       
    }
</MudMainContent>